(function(){angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]);angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]);angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(D){var C=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function(R,O,Q,X,P,V){var T=0;var W=0;var S=V.latencyThreshold;var B;function U(){Q.cancel(B);V.complete();W=0;T=0}function A(I){var H;var G=O.get("$http");var F=D.defaults;if((I.cache||F.cache)&&I.cache!==false&&(I.method==="GET"||I.method==="JSONP")){H=angular.isObject(I.cache)?I.cache:angular.isObject(F.cache)?F.cache:G}var E=H!==undefined?H.get(I.url)!==undefined:false;if(I.cached!==undefined&&E!==I.cached){return I.cached}I.cached=E;return E}return{"request":function(E){if(!E.ignoreLoadingBar&&!A(E)){X.$broadcast("cfpLoadingBar:loading",{url:E.url});if(T===0){B=Q(function(){V.start()},S)}T++;V.set(W/T)}return E},"response":function(E){if(!E||!E.config){P.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return E}if(!E.config.ignoreLoadingBar&&!A(E.config)){W++;X.$broadcast("cfpLoadingBar:loaded",{url:E.config.url,result:E});if(W>=T){U()}else{V.set(W/T)}}return E},"responseError":function(E){if(!E||!E.config){P.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50");return R.reject(E)}if(!E.config.ignoreLoadingBar&&!A(E.config)){W++;X.$broadcast("cfpLoadingBar:loaded",{url:E.config.url,result:E});if(W>=T){U()}else{V.set(W/T)}}return R.reject(E)}}}];D.interceptors.push(C)}]);angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.autoIncrement=true;this.includeSpinner=true;this.includeBar=true;this.latencyThreshold=100;this.startSize=0.02;this.parentSelector="body";this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>';this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>';this.$get=["$injector","$document","$timeout","$rootScope",function(e,c,p,b){var i;var o=this.parentSelector,n=angular.element(this.loadingBarTemplate),Z=n.find("div").eq(0),Y=angular.element(this.spinnerTemplate);var d,a,X=false,f=0;var r=this.autoIncrement;var g=this.includeSpinner;var m=this.includeBar;var h=this.startSize;function j(){if(!i){i=e.get("$animate")}p.cancel(a);if(X){return}var C=c[0];var D=C.querySelector?C.querySelector(o):c.find(o)[0];if(!D){D=C.getElementsByTagName("body")[0]}var B=angular.element(D);var A=D.lastChild&&angular.element(D.lastChild);b.$broadcast("cfpLoadingBar:started");X=true;if(m){i.enter(n,B,A)}if(g){i.enter(Y,B,n)}t(h)}function t(A){if(!X){return}var B=(A*100)+"%";Z.css("width",B);f=A;if(r){p.cancel(d);d=p(function(){l()},250)}}function l(){if(s()>=1){return}var C=0;var A=s();if(A>=0&&A<0.25){C=(Math.random()*(5-3+1)+3)/100}else{if(A>=0.25&&A<0.65){C=(Math.random()*3)/100}else{if(A>=0.65&&A<0.9){C=(Math.random()*2)/100}else{if(A>=0.9&&A<0.99){C=0.005}else{C=0}}}}var B=s()+C;t(B)}function s(){return f}function q(){f=0;X=false}function k(){if(!i){i=e.get("$animate")}b.$broadcast("cfpLoadingBar:completed");t(1);p.cancel(a);a=p(function(){var A=i.leave(n,q);if(A&&A.then){A.then(q)}i.leave(Y)},500)}return{start:j,set:t,status:s,inc:l,complete:k,autoIncrement:this.autoIncrement,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})})();